# Computer Graphic

---

## 1. 深度测试

- 深度缓冲包含了一个介于0.0和1.0之间的深度值，它将会与观察者视角所看见的场景中所有物体的z值进行比较。观察空间的z值可能是投影平截头体的**近平面**(Near)和**远平面**(Far)之间的任何值。我们需要一种方式来将这些观察空间的z值变换到[0, 1]范围之间，其中的一种方式就是将它们线性变换到[0, 1]范围之间。

- 使用一个非线性的深度方程，它是与 1/z 成正比的。它做的就是在z值很小的时候提供非常高的精度，而在z值很远的时候提供更少的精度。
  
  //tupian

#### 深度冲突

- 两个平面或者三角形非常紧密地平行排列在一起时会发生，深度缓冲没有足够的精度来决定两个形状哪个在前面。结果就是这两个形状不断地在切换前后顺序，这会导致很奇怪的花纹

- 防止深度冲突
  
  - 不要将物体摆放得太靠近，但要手动调节，麻烦
  
  - 将近平面设置得远一点，但会导致近平面内的物体无法渲染
  
  - 使用更高精度的深度缓冲（一般为24位），但要牺牲性能

## 2. 模板测试

- 模板测试是根据又一个缓冲来进行的，它叫做模板缓冲(Stencil Buffer)，我们可以在渲染的时候更新它来获得一些很有意思的效果。

- 可以用作渲染边框
  
  - 在绘制（需要添加轮廓的）物体之前，将模板函数设置为GL_ALWAYS，每当物体的片段被渲染时，将模板缓冲更新为1。
  
  . 渲染物体。
  
  . 禁用模板写入以及深度测试。
  
  . 将每个物体放大一点点。
  
  . 使用一个不同的片段着色器，输出一个单独的（边框）颜色。
  
  . 再次绘制物体，但只在它们片段的模板值不等于1时才绘制。
  
  . 再次启用模板写入和深度测试。

## 3. 混合

- 绘制顺序
  
  - 先绘制所有不透明的物体。
  
  - 对所有透明的物体排序。
  
  - 按顺序绘制所有透明的物体，先远后进。

## 4. 面剔除

- 默认情况下，逆时针顶点所定义的三角形将会被处理为正向三角形。

- 由此可以判断可以剔除正向面还是反向面

## 5. 法线贴图

- 每个fragment使用各自的法线，替代一个面上所有fragment使用同一个法线的技术叫做法线贴图（normal mapping）或凹凸贴图（bump mapping）

- 使用一个2D纹理来储存法线数据，从2D纹理中采样得到特定纹理的法线向量。

- ### 切线空间
  
  - 法线贴图中的法线向量在切线空间中，法线永远指着正z方向。
    
    > 上向量是表面的法线向量。右和前向量是切线(Tagent)和副切线(Bitangent)向量
  
  - 切线空间是位于三角形表面之上的空间，它就像法线贴图向量的本地空间。
  
  - 切线空间的一大好处是我们可以为任何类型的表面计算出一个这样的矩阵，由此我们可以把切线空间的z方向和表面的法线方向对齐。
  
  - 
